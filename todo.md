# Project TODO

## الخطوة 1: تحديث واجهة المراحل للاختيار المتعدد (بدون تغيير schema)
- [x] تحديث ProfileSetup.tsx لدعم اختيار متعدد (checkboxes) مع حفظ كـ JSON string
- [x] تحديث Dashboard.tsx لعرض المراحل المتعددة
- [x] اختبار الواجهة والتأكد من عدم وجود أخطاء
- [x] حفظ نقطة استعادة

## الخطوة 2: إضافة جدول الشواهد الفرعية
- [x] إضافة evidenceSubTemplates في schema.ts
- [x] تطبيق على قاعدة البيانات باستخدام pnpm db:push
- [x] اختبار الجدول الجديد
- [x] حفظ نقطة استعادة

## الخطوة 3-7: إضافة جميع الشواهد الفرعية (156 شاهد)
- [x] إنشاء سكريبت seed للشواهد الفرعية
- [x] إضافة الشاهد الرئيسي "تبادل الخبرات بين الزملاء" + 56 شاهد فرعي
- [x] إضافة الشاهد الرئيسي "مجتمعات التعلّم المهنية" + 100 شاهد فرعي
- [x] اختبار جميع الشواهد
- [x] حفظ نقطة استعادة

## الخطوة 8: تحديث الواجهة لعرض الشواهد الفرعية
- [x] تحديث Home.tsx لعرض الشواهد الفرعية مع أزرار التوسع/الطي
- [x] إضافة التصفية الذكية بناءً على المرحلة والمادة والصف والفصل والمسار
- [x] إضافة tRPC procedures لجلب الشواهد الفرعية
- [x] اختبار شامل للنظام
- [x] حفظ نقطة استعادة نهائية

## المرحلة الجديدة: نظام توليد شواهد PDF مخصص

### الخطوة 1: تصميم بنية قاعدة البيانات
- [x] إضافة جدول evidenceDetails لحفظ الشواهد المكتملة
- [x] إضافة حقول ديناميكية (JSON) للحقول المتغيرة
- [x] إضافة حقول للمحتوى النصي (7 أقسام)
- [x] إضافة حقول للصور (3 صور)
- [x] إضافة حقل للثيم المختار
- [x] إضافة حقول المحتوى الافتراضي لجدول evidenceSubTemplates
- [x] إضافة مثال "قلة المشاركة في قراءة القصص" مع المحتوى
- [x] تطبيق على قاعدة البيانات

### الخطوة 2: نموذج تعبئة الشاهد
- [x] إضافة زر للنقر على كل شاهد فرعي
- [x] إنشاء صفحة SubEvidenceForm.tsx
- [x] إضافة الصفحة الأولى: حقول ديناميكية (المنفذ، ساهم في التنفيذ، المستفيدون)
- [x] إضافة الصفحة الثانية: محرر نصوص للأقسام السبعة (معبأة مسبقاً)
- [x] إضافة صورتين افتراضيتين (placeholder)
- [x] إضافة رفع صور بالسحب والإفلات
- [x] حفظ البيانات في evidenceDetails
- [x] إضافة tRPC procedures (getSubTemplateById, evidenceDetails.save)
- [x] إضافة database functions (getSubTemplateById, createEvidenceDetail)
- [x] ربط الصفحة بالنقر على الشواهد الفرعية

### الخطوة 3: نظام توليد PDF
- [ ] بناء نظام ثيمات (templates)
- [ ] إضافة ثيم وزارة التعليم الافتراضي
- [ ] توليد الصفحة الأولى (البيانات الأساسية + الحقول المتغيرة)
- [ ] توليد الصفحة الثانية (الأقسام الستة + الصور)
- [ ] تنسيق الخطوط والألوان
- [ ] اختبار التوليد

### الخطوة 4: نظام الباركود
- [ ] توليد QR code لكل شاهد
- [ ] إضافة رابط للشاهد في الباركود
- [ ] وضع الباركود في موقعه المناسب
- [ ] اختبار الباركود

### الخطوة 5: الاختبار والتسليم
- [ ] اختبار شامل للنظام
- [ ] إضافة مثال "قلة المشاركة في قراءة القصص"
- [ ] توليد PDF تجريبي
- [ ] حفظ نقطة استعادة نهائية

## إصلاح عاجل: عرض الشواهد الفرعية
- [x] إصلاح getFilteredSubEvidence لعرض جميع الشواهد عندما لا يكون هناك ملف شخصي
- [x] إصلاح parsing لـ stage (نص عادي وليس JSON)
- [x] حذف template 16 المكرر
- [x] جعل hasSubEvidence ديناميكي بدلاً من hard-coded IDs (تم التراجع إلى hard-coded لحل مشكلة)
- [x] اختبار العرض مع وبدون ملف شخصي

## ملاحظات مهمة
- template 30002 "مجتمعات التعلّم المهنية" موجود في قاعدة البيانات وAPI يُرجعه، لكن لا يظهر في Frontend
- تم استخدام hard-coded IDs (30001, 30002) كحل مؤقت
- يحتاج debugging عميق لإصلاح المشكلة بشكل نهائي

## حل نهائي: إصلاح عدم ظهور template 30002
- [x] تشخيص السبب الحقيقي
- [x] إصلاح getByStandard إلى getByStandardId
- [x] إضافة hasSubEvidence إلى schema
- [x] حذف template 16 المكرر
- [ ] مشكلة متقطعة: template 30002 أحياناً يظهر وأحياناً لا يظهر (يحتاج debugging عميق)
- [ ] اختبار نموذج تعبئة شاهد آخر

## إضافة بيانات شاهد "الحضور والانصراف"
- [x] إيجاد evidenceTemplate ID لـ "الحضور والانصراف"
- [x] إضافة حقول sections و images إلى schema
- [x] إضافة evidenceSubTemplate بـ description و 6 sections
- [ ] اختبار عرض البيانات في نموذج التعبئة
