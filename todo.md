# Project TODO

## الخطوة 1: تحديث واجهة المراحل للاختيار المتعدد (بدون تغيير schema)
- [x] تحديث ProfileSetup.tsx لدعم اختيار متعدد (checkboxes) مع حفظ كـ JSON string
- [x] تحديث Dashboard.tsx لعرض المراحل المتعددة
- [x] اختبار الواجهة والتأكد من عدم وجود أخطاء
- [x] حفظ نقطة استعادة

## الخطوة 2: إضافة جدول الشواهد الفرعية
- [x] إضافة evidenceSubTemplates في schema.ts
- [x] تطبيق على قاعدة البيانات باستخدام pnpm db:push
- [x] اختبار الجدول الجديد
- [x] حفظ نقطة استعادة

## الخطوة 3-7: إضافة جميع الشواهد الفرعية (156 شاهد)
- [x] إنشاء سكريبت seed للشواهد الفرعية
- [x] إضافة الشاهد الرئيسي "تبادل الخبرات بين الزملاء" + 56 شاهد فرعي
- [x] إضافة الشاهد الرئيسي "مجتمعات التعلّم المهنية" + 100 شاهد فرعي
- [x] اختبار جميع الشواهد
- [x] حفظ نقطة استعادة

## الخطوة 8: تحديث الواجهة لعرض الشواهد الفرعية
- [x] تحديث Home.tsx لعرض الشواهد الفرعية مع أزرار التوسع/الطي
- [x] إضافة التصفية الذكية بناءً على المرحلة والمادة والصف والفصل والمسار
- [x] إضافة tRPC procedures لجلب الشواهد الفرعية
- [x] اختبار شامل للنظام
- [x] حفظ نقطة استعادة نهائية

## المرحلة الجديدة: نظام توليد شواهد PDF مخصص

### الخطوة 1: تصميم بنية قاعدة البيانات
- [x] إضافة جدول evidenceDetails لحفظ الشواهد المكتملة
- [x] إضافة حقول ديناميكية (JSON) للحقول المتغيرة
- [x] إضافة حقول للمحتوى النصي (7 أقسام)
- [x] إضافة حقول للصور (3 صور)
- [x] إضافة حقل للثيم المختار
- [x] إضافة حقول المحتوى الافتراضي لجدول evidenceSubTemplates
- [x] إضافة مثال "قلة المشاركة في قراءة القصص" مع المحتوى
- [x] تطبيق على قاعدة البيانات

### الخطوة 2: نموذج تعبئة الشاهد
- [x] إضافة زر للنقر على كل شاهد فرعي
- [x] إنشاء صفحة SubEvidenceForm.tsx
- [x] إضافة الصفحة الأولى: حقول ديناميكية (المنفذ، ساهم في التنفيذ، المستفيدون)
- [x] إضافة الصفحة الثانية: محرر نصوص للأقسام السبعة (معبأة مسبقاً)
- [x] إضافة صورتين افتراضيتين (placeholder)
- [x] إضافة رفع صور بالسحب والإفلات
- [x] حفظ البيانات في evidenceDetails
- [x] إضافة tRPC procedures (getSubTemplateById, evidenceDetails.save)
- [x] إضافة database functions (getSubTemplateById, createEvidenceDetail)
- [x] ربط الصفحة بالنقر على الشواهد الفرعية

### الخطوة 3: نظام توليد PDF
- [ ] بناء نظام ثيمات (templates)
- [ ] إضافة ثيم وزارة التعليم الافتراضي
- [ ] توليد الصفحة الأولى (البيانات الأساسية + الحقول المتغيرة)
- [ ] توليد الصفحة الثانية (الأقسام الستة + الصور)
- [ ] تنسيق الخطوط والألوان
- [ ] اختبار التوليد

### الخطوة 4: نظام الباركود
- [ ] توليد QR code لكل شاهد
- [ ] إضافة رابط للشاهد في الباركود
- [ ] وضع الباركود في موقعه المناسب
- [ ] اختبار الباركود

### الخطوة 5: الاختبار والتسليم
- [ ] اختبار شامل للنظام
- [ ] إضافة مثال "قلة المشاركة في قراءة القصص"
- [ ] توليد PDF تجريبي
- [ ] حفظ نقطة استعادة نهائية

## إصلاح عاجل: عرض الشواهد الفرعية
- [x] إصلاح getFilteredSubEvidence لعرض جميع الشواهد عندما لا يكون هناك ملف شخصي
- [x] إصلاح parsing لـ stage (نص عادي وليس JSON)
- [x] حذف template 16 المكرر
- [x] جعل hasSubEvidence ديناميكي بدلاً من hard-coded IDs (تم التراجع إلى hard-coded لحل مشكلة)
- [x] اختبار العرض مع وبدون ملف شخصي

## ملاحظات مهمة
- template 30002 "مجتمعات التعلّم المهنية" موجود في قاعدة البيانات وAPI يُرجعه، لكن لا يظهر في Frontend
- تم استخدام hard-coded IDs (30001, 30002) كحل مؤقت
- يحتاج debugging عميق لإصلاح المشكلة بشكل نهائي

## حل نهائي: إصلاح عدم ظهور template 30002
- [x] تشخيص السبب الحقيقي
- [x] إصلاح getByStandard إلى getByStandardId
- [x] إضافة hasSubEvidence إلى schema
- [x] حذف template 16 المكرر
- [ ] مشكلة متقطعة: template 30002 أحياناً يظهر وأحياناً لا يظهر (يحتاج debugging عميق)
- [ ] اختبار نموذج تعبئة شاهد آخر

## إضافة بيانات شاهد "الحضور والانصراف"
- [x] إيجاد evidenceTemplate ID لـ "الحضور والانصراف"
- [x] إضافة حقول sections و images إلى schema
- [x] إضافة evidenceSubTemplate بـ description و 6 sections
- [x] تحديث SubEvidenceForm لعرض عناوين الأقسام بشكل ديناميكي
- [x] مشكلة: title و description لا يظهران في المربع الأبيض (تم الحل)
  - [x] التحقق من وجود البيانات في قاعدة البيانات (ID 101) - البيانات موجودة
  - [x] فحص API response من getSubTemplateById - يُرجع array بدلاً من object
  - [x] إضافة console.log في SubEvidenceForm للتحقق من البيانات المستلمة
  - [x] إصلاح data structure في getSubTemplateById (db.execute يُرجع [rows, fields])
  - [x] اختبار العرض في المتصفح - يعمل بنجاح

## تحديث بيانات شاهد "الحضور والانصراف"
- [x] تحديث description بالمقدمة الكاملة
- [x] تحديث الأقسام الستة بالمحتوى المرسل
- [x] إضافة placeholders للصور (المعلم يرفع الصور عند التعبئة)
- [x] اختبار العرض في نموذج التعبئة - يعمل بنجاح
- [x] حفظ checkpoint

## تعبئة نموذج شاهد "الحضور والانصراف" (اختبار)
- [x] تعبئة الصفحة الأولى (المنفذ، المساهمون، المستفيدون)
- [x] الصفحة الثانية تحتوي على المحتوى المُعد مسبقاً
- [x] حفظ النموذج - نجح بدون أخطاء
- [x] التحقق من حفظ البيانات في قاعدة البيانات - جميع الحقول محفوظة
- [ ] عرض الشاهد المكتمل (يحتاج بناء صفحة عرض)

## إنشاء نموذج PDF لمعاينة الطباعة
- [ ] إنشاء HTML template بثيم وزارة التعليم (شعار، ألوان، خطوط)
- [ ] تصميم الصفحة الأولى (المعلومات الأساسية + المقدمة)
- [ ] تصميم الصفحة الثانية (الأقسام الستة + الصور)
- [ ] إضافة باركود QR للتحقق
- [ ] توليد PDF بحجم A4
- [ ] اختبار الطباعة

## إعادة تصميم PDF بالالتزام بالتصميم الأصلي
- [x] فحص PDF الأصلي المرسل
- [x] أخذ لقطات شاشة من الصفحتين
- [x] تحليل مواقع مربعات النص
- [x] إعادة برمجة HTML بدون خلفيات أو شعارات
- [x] الالتزام بمواقع المربعات الأصلية
- [x] توليد PDF جديد
- [x] مقارنة النتيجة بالتصميم الأصلي - تم إنشاء نموذج PDF نظيف
- [ ] انتظار الورقة المفرغة من المستخدم لبرمجتها بدقة

## برمجة نموذج الشاهد الجديد (حسب التصميم المرسل)
- [x] فحص الصور المفرغة والمعبأة
- [x] تحليل البيانات في كل مربع
- [x] برمجة HTML للصفحة الأولى (حقول تعبئة)
- [x] برمجة HTML للصفحة الثانية (6 مربعات + صورتين)
- [x] إضافة نظام السحب والإفلات للصور
- [ ] ربط النموذج بقاعدة البيانات (مرحلة لاحقة)
- [x] اختبار التعبئة والحفظ - يعمل بنجاح
- [ ] توليد PDF مع الثيمات المختلفة (مرحلة لاحقة)

## تحديث SubEvidenceForm بالتصميم الجديد
- [x] نسخ التصميم من HTML template إلى SubEvidenceFormNew
- [x] ربط حقول الصفحة الأولى بـ customFields
- [x] ربط حقول الصفحة الثانية بـ section1-6Content
- [x] إضافة نظام رفع الصور (drag & drop)
- [x] عرض المحتوى المُعبأ مسبقاً في الصفحة الثانية
- [x] إضافة route للنموذج الجديد (/evidence/sub-new/:id)
- [x] اختبار العرض - يعمل بنجاح 100%
- [ ] ربط رفع الصور بـS3 (مرحلة لاحقة)
- [ ] إضافة زر "معاينة" بعد الحفظ (مرحلة لاحقة)
- [ ] بناء صفحة معاينة PDF (مرحلة لاحقة)
- [ ] إضافة نظام توليد PDF مع QR Code (مرحلة لاحقة)
- [ ] اختبار عملية الحفظ
- [x] حفظ checkpoint
